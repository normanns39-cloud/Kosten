<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Restaurant-Abrechnung</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background-color: #f0f2f5; color: #1c1e21; }
        .card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); max-width: 450px; margin: auto; }
        h1 { color: #007bff; border-bottom: 2px solid #007bff; padding-bottom: 10px; margin-top: 0; text-align: center; font-size: 1.4em; }
        .total-card { background: #007bff; color: white; padding: 20px; border-radius: 10px; text-align: center; margin-bottom: 20px; }
        .total-amount { font-size: 2.2em; font-weight: bold; }
        .input-group { margin: 20px 0; background: #f8f9fa; padding: 15px; border-radius: 8px; border: 1px solid #eee; }
        label { display: block; margin-bottom: 5px; font-weight: bold; color: #606770; font-size: 0.9em; }
        select, input { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 1em; box-sizing: border-box; margin-bottom: 10px; }
        .btn-save { width: 100%; padding: 12px; background: #28a745; color: white; border: none; border-radius: 8px; font-size: 1.1em; cursor: pointer; font-weight: bold; }
        .user-row { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px dashed #ddd; }
        .name { font-weight: bold; }
        .btn-reset { margin-top: 30px; background: none; border: none; color: #ccc; cursor: pointer; font-size: 0.7em; width: 100%; text-decoration: underline; }
    </style>
</head>
<body>
    <div class="card">
        <h1>Guthaben Rechner</h1>
        
        <div class="total-card">
            <div>Rest-Guthaben:</div>
            <div class="total-amount" id="restGuthaben">150.000</div>
            <div>HUF</div>
        </div>

        <div class="input-group">
            <label>Wer zahlt ein?</label>
            <select id="userSelect">
                <option value="Rosi">Rosi</option>
                <option value="Anki">Anki</option>
                <option value="Norman">Norman</option>
                <option value="André">André</option>
            </select>

            <label>Betrag (HUF):</label>
            <input type="number" id="betragInput" placeholder="Zahl eingeben..." inputmode="numeric">
            <button class="btn-save" onclick="saveData()">Einzahlung hinzufügen</button>
        </div>

        <div id="details">
            <p><strong>Bisherige Gesamtsummen:</strong></p>
            <div id="userList"></div>
        </div>

        <button class="btn-reset" onclick="resetAll()">Daten für neuen Monat löschen</button>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getDatabase, ref, set, onValue, runTransaction } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAmJbQpCAPz1T_b3H18lPFbqJ11UB9Ou48",
            authDomain: "essenskosten.firebaseapp.com",
            projectId: "essenskosten",
            databaseURL: "https://essenskosten-default-rtdb.europe-west1.firebasedatabase.app"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const kassenRef = ref(db, 'haushalt/restaurant');

        const START_GUTHABEN = 150000;

        // Daten live anzeigen & Rechnen
        onValue(kassenRef, (snapshot) => {
            const data = snapshot.val() || {};
            const userList = document.getElementById('userList');
            userList.innerHTML = '';
            
            let gesamtEinzahlungen = 0;
            const users = ["Rosi", "Anki", "Norman", "André"];
            
            users.forEach(user => {
                const betrag = parseInt(data[user] || 0);
                gesamtEinzahlungen += betrag;
                
                const div = document.createElement('div');
                div.className = 'user-row';
                div.innerHTML = `<span class="name">${user}:</span> <span>${betrag.toLocaleString('de-DE')} HUF</span>`;
                userList.appendChild(div);
            });

            const rest = START_GUTHABEN - gesamtEinzahlungen;
            document.getElementById('restGuthaben').innerText = rest.toLocaleString('de-DE');
        });

        // Funktion zum Addieren
        window.saveData = function() {
            const user = document.getElementById('userSelect').value;
            const neuerBetrag = parseInt(document.getElementById('betragInput').value);
            
            if(neuerBetrag && neuerBetrag > 0) {
                const userRef = ref(db, 'haushalt/restaurant/' + user);
                
                runTransaction(userRef, (currentValue) => {
                    const alterWert = parseInt(currentValue || 0);
                    return alterWert + neuerBetrag;
                }).then(() => {
                    document.getElementById('betragInput').value = "";
                });
            } else {
                alert("Bitte einen Betrag eingeben.");
            }
        }

        // Alles auf Null setzen
        window.resetAll = function() {
            if(confirm("Möchtest du wirklich alle Einzahlungen löschen und von vorne beginnen?")) {
                set(kassenRef, { Rosi: 0, Anki: 0, Norman: 0, André: 0 });
            }
        }
    </script>
</body>
</html>
